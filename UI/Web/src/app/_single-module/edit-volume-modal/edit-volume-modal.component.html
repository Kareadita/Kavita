<ng-container *transloco="let t; read: 'edit-volume-modal'">
  <div class="modal-container">
    <div class="modal-header">
      <h4 class="modal-title">{{t('title')}} <app-entity-title [libraryType]="libraryType" [entity]="volume" [prioritizeTitleName]="false"></app-entity-title></h4>
      <button type="button" class="btn-close" [attr.aria-label]="t('close')" (click)="close()"></button>
    </div>
    <div class="modal-body scrollable-modal" [ngClass]="{'d-flex': utilityService.getActiveBreakpoint() !== Breakpoint.Mobile}">
      <form [formGroup]="editForm">
        <ul ngbNav #nav="ngbNav" [(activeId)]="activeId" class="nav-pills" orientation="{{utilityService.getActiveBreakpoint() === Breakpoint.Mobile ? 'horizontal' : 'vertical'}}" style="min-width: 135px;">

          <!-- General Tab -->
          <li [ngbNavItem]="TabID.General">
            <a ngbNavLink>{{t(TabID.General)}}</a>
            <ng-template ngbNavContent>

            </ng-template>
          </li>

          <!-- Tags Tab -->
<!--          <li [ngbNavItem]="TabID.Tags">-->
<!--            <a ngbNavLink>{{t(TabID.Tags)}}</a>-->
<!--            <ng-template ngbNavContent>-->
<!--              &lt;!&ndash; genre & tag &ndash;&gt;-->
<!--              <div class="row g-0">-->
<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('genres-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updateGenres($event);volume.genresLocked = true" [settings]="genreSettings"-->
<!--                                       [(locked)]="volume.genresLocked" (onUnlock)="volume.genresLocked = false"-->
<!--                                       (newItemAdded)="volume.genresLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.title}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.title}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->

<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('tags-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updateTags($event);volume.tagsLocked = true" [settings]="tagsSettings"-->
<!--                                       [(locked)]="volume.tagsLocked" (onUnlock)="volume.tagsLocked = false"-->
<!--                                       (newItemAdded)="volume.tagsLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; imprint & publisher &ndash;&gt;-->
<!--              <div class="row g-0">-->
<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('imprint-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updatePerson($event, PersonRole.Imprint);volume.imprintLocked = true" [settings]="getPersonsSettings(PersonRole.Imprint)"-->
<!--                                       [(locked)]="volume.imprintLocked" (onUnlock)="volume.imprintLocked = false"-->
<!--                                       (newItemAdded)="volume.imprintLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->

<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('publisher-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updatePerson($event, PersonRole.Publisher);volume.publisherLocked = true" [settings]="getPersonsSettings(PersonRole.Publisher)"-->
<!--                                       [(locked)]="volume.publisherLocked" (onUnlock)="volume.publisherLocked = false"-->
<!--                                       (newItemAdded)="volume.publisherLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; team & location &ndash;&gt;-->
<!--              <div class="row g-0">-->
<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('team-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updatePerson($event, PersonRole.Team);volume.teamLocked = true" [settings]="getPersonsSettings(PersonRole.Team)"-->
<!--                                       [(locked)]="volume.teamLocked" (onUnlock)="volume.teamLocked = false"-->
<!--                                       (newItemAdded)="volume.teamLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->

<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('location-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updatePerson($event, PersonRole.Location);volume.locationLocked = true" [settings]="getPersonsSettings(PersonRole.Location)"-->
<!--                                       [(locked)]="volume.locationLocked" (onUnlock)="volume.locationLocked = false"-->
<!--                                       (newItemAdded)="volume.locationLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; character &ndash;&gt;-->
<!--              <div class="row g-0">-->
<!--                <div class="col-lg-12 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('character-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updatePerson($event, PersonRole.Character);volume.characterLocked = true" [settings]="getPersonsSettings(PersonRole.Character)"-->
<!--                                       [(locked)]="volume.characterLocked" (onUnlock)="volume.characterLocked = false"-->
<!--                                       (newItemAdded)="volume.characterLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->

<!--            </ng-template>-->
<!--          </li>-->

          <!-- People Tab -->
<!--          <li [ngbNavItem]="TabID.People">-->
<!--            <a ngbNavLink>{{t(TabID.People)}}</a>-->
<!--            <ng-template ngbNavContent>-->
<!--              &lt;!&ndash; writer & cover artist &ndash;&gt;-->
<!--              <div class="row g-0">-->
<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('writer-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updatePerson($event, PersonRole.Writer);volume.writerLocked = true" [settings]="getPersonsSettings(PersonRole.Writer)"-->
<!--                                       [(locked)]="volume.writerLocked" (onUnlock)="volume.writerLocked = false"-->
<!--                                       (newItemAdded)="volume.writerLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->

<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('cover-artist-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updatePerson($event, PersonRole.CoverArtist);volume.coverArtistLocked = true" [settings]="getPersonsSettings(PersonRole.CoverArtist)"-->
<!--                                       [(locked)]="volume.coverArtistLocked" (onUnlock)="volume.coverArtistLocked = false"-->
<!--                                       (newItemAdded)="volume.coverArtistLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; penciller & colorist &ndash;&gt;-->
<!--              <div class="row g-0">-->
<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('penciller-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updatePerson($event, PersonRole.Penciller);volume.pencillerLocked = true" [settings]="getPersonsSettings(PersonRole.Penciller)"-->
<!--                                       [(locked)]="volume.pencillerLocked" (onUnlock)="volume.pencillerLocked = false"-->
<!--                                       (newItemAdded)="volume.pencillerLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->

<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('colorist-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updatePerson($event, PersonRole.Colorist);volume.coloristLocked = true" [settings]="getPersonsSettings(PersonRole.Colorist)"-->
<!--                                       [(locked)]="volume.coloristLocked" (onUnlock)="volume.coloristLocked = false"-->
<!--                                       (newItemAdded)="volume.coloristLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; inker & letterer &ndash;&gt;-->
<!--              <div class="row g-0">-->
<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('inker-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updatePerson($event, PersonRole.Inker);volume.inkerLocked = true" [settings]="getPersonsSettings(PersonRole.Inker)"-->
<!--                                       [(locked)]="volume.inkerLocked" (onUnlock)="volume.inkerLocked = false"-->
<!--                                       (newItemAdded)="volume.inkerLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->

<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('letterer-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updatePerson($event, PersonRole.Letterer);volume.lettererLocked = true" [settings]="getPersonsSettings(PersonRole.Letterer)"-->
<!--                                       [(locked)]="volume.lettererLocked" (onUnlock)="volume.lettererLocked = false"-->
<!--                                       (newItemAdded)="volume.lettererLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; translator &ndash;&gt;-->
<!--              <div class="row g-0">-->
<!--                <div class="col-lg-12 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('translator-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        <app-typeahead (selectedData)="updatePerson($event, PersonRole.Translator);volume.translatorLocked = true" [settings]="getPersonsSettings(PersonRole.Translator)"-->
<!--                                       [(locked)]="volume.translatorLocked" (onUnlock)="volume.translatorLocked = false"-->
<!--                                       (newItemAdded)="volume.translatorLocked = true">-->
<!--                          <ng-template #badgeItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                          <ng-template #optionItem let-item let-position="idx">-->
<!--                            {{item.name}}-->
<!--                          </ng-template>-->
<!--                        </app-typeahead>-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->

<!--            </ng-template>-->
<!--          </li>-->

          <!-- Cover Tab -->
          <li [ngbNavItem]="TabID.CoverImage">
            <a ngbNavLink>{{t(TabID.CoverImage)}}</a>
            <ng-template ngbNavContent>
              <p class="alert alert-warning" role="alert">
                {{t('cover-image-description')}}
              </p>
              <app-cover-image-chooser [(imageUrls)]="imageUrls" (imageSelected)="updateSelectedIndex($event)" (selectedBase64Url)="updateSelectedImage($event)"
                                       [showReset]="volume.coverImageLocked" (resetClicked)="handleReset()"></app-cover-image-chooser>
            </ng-template>
          </li>

          <!-- Info Tab -->
          <li [ngbNavItem]="TabID.Info">
            <a ngbNavLink>{{t(TabID.Info)}}</a>
            <ng-template ngbNavContent>
              <div class="row g-0">
                <div class="col-lg-6 col-md-12 pe-2">
                  <div class="mb-3">
                    <app-setting-item [title]="t('pages-label')" [toggleOnViewClick]="false" [showEdit]="false">
                      <ng-template #view>
                        {{t('pages-count', {num: volume.pages | compactNumber})}}
                      </ng-template>
                    </app-setting-item>
                  </div>
                </div>
<!--                <div class="col-lg-6 col-md-12 pe-2">-->
<!--                  <div class="mb-3">-->
<!--                    <app-setting-item [title]="t('words-label')" [toggleOnViewClick]="false" [showEdit]="false">-->
<!--                      <ng-template #view>-->
<!--                        {{t('words-count', {num: volume.wordCount | compactNumber})}}-->
<!--                      </ng-template>-->
<!--                    </app-setting-item>-->
<!--                  </div>-->
<!--                </div>-->
              </div>

              <div class="row g-0">
                <div class="col-lg-6 col-md-12 pe-2">
                  <div class="mb-3">
                    <app-setting-item [title]="t('read-time-label')" [toggleOnViewClick]="false" [showEdit]="false">
                      <ng-template #view>
                        {{volume | readTime }}
                      </ng-template>
                    </app-setting-item>
                  </div>
                </div>
                <div class="col-lg-6 col-md-12 pe-2">
                  <div class="mb-3">
                    <app-setting-item [title]="t('size-label')" [toggleOnViewClick]="false" [showEdit]="false">
                      <ng-template #view>
                        {{size | bytes}}
                      </ng-template>
                    </app-setting-item>
                  </div>
                </div>
              </div>


              <div class="row g-0">
                <div class="col-lg-6 col-md-12 pe-2">
                  <div class="mb-3">
                    <app-setting-item [title]="t('date-added-label')" [toggleOnViewClick]="false" [showEdit]="false">
                      <ng-template #view>
                        {{volume.createdUtc | utcToLocalTime | translocoDate: {dateStyle: 'short', timeStyle: 'short' } | defaultDate}}
                      </ng-template>
                    </app-setting-item>
                  </div>
                </div>
                <div class="col-lg-6 col-md-12 pe-2">
                  <div class="mb-3">
                    <app-setting-item [title]="t('id-label')" [toggleOnViewClick]="false" [showEdit]="false">
                      <ng-template #view>
                        {{volume.id}}
                      </ng-template>
                    </app-setting-item>
                  </div>
                </div>
              </div>


              @if (WebLinks.length > 0) {
                <div class="setting-section-break"></div>
                <div class="row g-0">
                  <div class="col-auto">
                    <app-icon-and-title [label]="t('links-title')" [clickable]="false" fontClasses="fa-solid fa-link" [title]="t('links-title')">
                      @for(link of WebLinks; track link) {
                        <a class="me-1" [href]="link | safeHtml" target="_blank" rel="noopener noreferrer" [title]="link">
                          <app-image height="24px" width="24px" aria-hidden="true" [imageUrl]="imageService.getWebLinkImage(link)"
                                     [errorImage]="imageService.errorWebLinkImage"></app-image>
                        </a>
                      }
                    </app-icon-and-title>
                  </div>
                </div>
              }

              <app-setting-item [title]="t('files-label')" [toggleOnViewClick]="false" [showEdit]="false">
                <ng-template #view>
                  @for (file of files; track file.id) {
                    <div>
                      <span>{{file.filePath}}</span><span class="ms-2 me-2">•</span><span>{{file.bytes | bytes}}</span>
                    </div>
                  }
                </ng-template>
              </app-setting-item>

            </ng-template>
          </li>

          <!-- Progress Tab -->
          <li [ngbNavItem]="TabID.Progress">
            <a ngbNavLink>{{t(TabID.Progress)}}</a>
            <ng-template ngbNavContent>
              @for(chapter of volume.chapters; track chapter.id) {
                <h6><app-entity-title [entity]="chapter" [prioritizeTitleName]="false"></app-entity-title></h6>
                <app-edit-chapter-progress [chapter]="chapter"></app-edit-chapter-progress>
                <div class="setting-section-break"></div>
              }
            </ng-template>
          </li>

          <!-- Tasks Tab -->
          <li [ngbNavItem]="TabID.Tasks">
            <a ngbNavLink>{{t(TabID.Tasks)}}</a>
            <ng-template ngbNavContent>
              @for(task of tasks; track task.action) {
                <div class="mt-3 mb-3">
                  <app-setting-button [subtitle]="task.description">
                    <button class="btn btn-{{task.action === Action.Delete ? 'danger' : 'secondary'}} btn-sm mb-2" (click)="runTask(task)">{{task.title}}</button>
                  </app-setting-button>
                </div>
              }
            </ng-template>
          </li>
        </ul>
      </form>

      <div [ngbNavOutlet]="nav" class="tab-content {{utilityService.getActiveBreakpoint() === Breakpoint.Mobile ? 'mt-3' : 'ms-4 flex-fill'}}"></div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="close()">{{t('close')}}</button>
      <button type="submit" class="btn btn-primary" [disabled]="!editForm.valid" (click)="save()">{{t('save')}}</button>
    </div>
  </div>


  <ng-template #lock let-item="item" let-field="field">
    <span class="input-group-text clickable" (click)="unlock(item, field)">
        <i class="fa fa-lock" aria-hidden="true"></i>
        <span class="visually-hidden">{{t('field-locked-alt')}}</span>
    </span>
  </ng-template>


</ng-container>
