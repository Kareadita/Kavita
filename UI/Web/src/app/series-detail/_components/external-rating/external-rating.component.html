<div class="row">
  <div class="col-auto custom-col clickable" [ngbPopover]="popContent"
       popoverTitle="Your Rating + Overall" popoverClass="md-popover">
    <span class="badge rounded-pill me-1">
      <img class="me-1" ngSrc="assets/images/logo-32.png" width="24" height="24" alt="">
      {{userRating * 20}}
      <ng-container *ngIf="overallRating > 0; else noOverallRating"> + {{overallRating}}%</ng-container>
      <ng-template #noOverallRating>%</ng-template>
    </span>
  </div>

  <div class="col-auto custom-col clickable" *ngFor="let rating of ratings" [ngbPopover]="externalPopContent" [popoverContext]="{rating: rating}"
       [popoverTitle]="rating.provider | providerName" popoverClass="sm-popover">
    <span class="badge rounded-pill me-1">
      <img class="me-1" [ngSrc]="rating.provider | providerImage" width="24" height="24" alt="">
      {{rating.averageScore}}%
    </span>
  </div>
  <div class="col-auto" style="padding-top: 8px">
    <app-loading [loading]="isLoading" size="spinner-border-sm"></app-loading>
  </div>
</div>

<ng-template #popContent>
  <ngb-rating class="rating-star" [(rate)]="userRating" (rateChange)="updateRating($event)" [resettable]="false">
    <ng-template let-fill="fill" let-index="index">
      <span class="star" [class.filled]="(index < userRating) && userRating > 0">&#9733;</span>
    </ng-template>
  </ngb-rating> {{userRating * 20}}%
</ng-template>

<ng-template #externalPopContent let-rating="rating">
  <i class="fa-solid fa-heart" aria-hidden="true"></i> {{rating.favoriteCount}}
</ng-template>
