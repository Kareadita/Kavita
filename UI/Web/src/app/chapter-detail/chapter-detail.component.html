<ng-container *transloco="let t; read: 'series-detail'">

  <div [ngStyle]="{'height': ScrollingBlockHeight}" class="main-container container-fluid pt-2" #scrollingBlock>

    @if (chapter && series) {
      <div class="row mb-0 mb-xl-3 info-container">
        <div class="image-container col-4 col-sm-6 col-md-4 col-lg-4 col-xl-2 col-xxl-2 d-none d-sm-block mt-2">

          <app-image [styles]="{'object-fit': 'contain', 'background': 'none', 'max-height': '400px', 'height': '100%'}" height="400px"  [imageUrl]="coverImage"></app-image>
            @if (chapter.pagesRead < chapter.pages && hasReadingProgress) {
              <div class="progress-banner" ngbTooltip="{{(chapter.pagesRead / chapter.pages) * 100 | number:'1.0-1'}}%">
                <ngb-progressbar type="primary" height="5px" [value]="chapter.pagesRead" [max]="chapter.pages" [showValue]="true"></ngb-progressbar>
              </div>
            }
        </div>
        <div class="col-xlg-10 col-lg-8 col-md-8 col-xs-8 col-sm-6 mt-2">
          <h4 class="title">
            <a routerLink="/library/{{series.libraryId}}/series/{{series.id}}" class="dark-exempt btn-icon">{{series.name}}</a>
          </h4>
          <div class="subtitle">
            <span>
              <app-entity-title [libraryType]="libraryType!" [entity]="chapter" [prioritizeTitleName]="false"></app-entity-title>
            </span>
            @if (chapter.titleName) {
              <span class="ms-2 me-2">•</span>
              <span>{{chapter.titleName}}</span>
            }
          </div>

          <div class="mt-2">
            @if (chapter.publishers.length > 0) {
              <span class="me-2">{{chapter.publishers[0]}}</span>
            }
            @if (chapter.ageRating !== AgeRating.Unknown) {
              <span class="me-2">
              {{chapter.ageRating | ageRating}}
            </span>
            } @else {
              <span class="me-2">
              <app-image imageUrl="./assets/images/ratings/unknown-rating.png" height="32px" width="32px"></app-image>
            </span>
            }

            <span class="me-2"><i class="fa-regular fa-clock me-1" aria-hidden="true"></i> {{chapter.avgHoursToRead | timeDuration }}</span>
            <span class="ms-2 me-2">•</span>
            <span>{{chapter.pages}} pages</span>
          </div>

          <!-- Rating goes here (after I implement support for rating individual issues -->
          @if (libraryType !== null && series) {
            <div class="mt-2">
              <app-external-rating [seriesId]="series.id"
                                   [ratings]="[]"
                                   [userRating]="series.userRating"
                                   [hasUserRated]="series.hasUserRated"
                                   [libraryType]="libraryType">
              </app-external-rating>
            </div>
          }

          <div class="mt-2">
            <div class="row g-0">
              <div class="col-auto">
                <div class="btn-group">
                  <button type="button" class="btn btn-primary-outline" (click)="read()">
                  <span>
                <i class="fa {{hasReadingProgress ? 'fa-book-open' : 'fa-book'}}" aria-hidden="true"></i>
                <span class="read-btn--text">&nbsp;{{(hasReadingProgress) ? t('continue') : t('read')}}</span>
              </span>
                  </button>
                  <div class="btn-group" ngbDropdown role="group" display="dynamic" [attr.aria-label]="t('read-options-alt')">
                    <button type="button" class="btn btn-primary-outline dropdown-toggle-split" ngbDropdownToggle></button>
                    <div class="dropdown-menu" ngbDropdownMenu>
                      <button ngbDropdownItem (click)="read(true)">
                  <span>
                    <i class="fa fa-glasses" aria-hidden="true"></i>
                    <span class="read-btn--text">&nbsp;{{(hasReadingProgress) ? t('continue-incognito') : t('read-incognito')}}</span>
                  </span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>



              @if (accountService.isAdmin$ | async) {
                <div class="col-auto ms-2">
                  <button class="btn btn-secondary-outline" id="edit-btn--komf" (click)="openEditModal()" [title]="t('edit-series-alt')">
                    <span><i class="fa fa-pen" aria-hidden="true"></i></span>
                  </button>
                </div>
              }

<!--              @if (accountService.isAdmin$ | async || hasDownloadingRole) {-->
<!--                <div class="col-auto ms-2 d-none d-md-block">-->
<!--                  @if (download$ | async; as download) {-->
<!--                    <button class="btn btn-secondary-outline" (click)="downloadSeries()" [title]="t('download-series&#45;&#45;tooltip')" [disabled]="download !== null">-->
<!--                      @if (download !== null) {-->
<!--                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>-->
<!--                        <span class="visually-hidden">{{t('downloading-status')}}</span>-->
<!--                      } @else {-->
<!--                        <i class="fa fa-arrow-alt-circle-down" aria-hidden="true"></i>-->
<!--                      }-->
<!--                    </button>-->
<!--                  } @else {-->
<!--                    <button class="btn btn-secondary-outline" (click)="download()" [title]="t('download-series&#45;&#45;tooltip')">-->
<!--                      <i class="fa fa-arrow-alt-circle-down" aria-hidden="true"></i>-->
<!--                    </button>-->
<!--                  }-->
<!--                </div>-->
<!--              }-->

            </div>
          </div>

          <div class="mt-3">
            <app-read-more [text]="chapter.summary || ''"></app-read-more>
          </div>

          <div class="mt-2">
            <div class="row g-0">
              <div class="col-6">
                Writers
              </div>
              <div class="col-6">
                Artists
              </div>
            </div>
          </div>

        </div>
      </div>

      <ul ngbNav #nav="ngbNav" [(activeId)]="activeTabId" class="nav nav-tabs mb-2" [destroyOnHide]="true" (navChange)="onNavChange($event)">
        <li [ngbNavItem]="TabID.Related">
          <a ngbNavLink>{{t('related-tab')}}</a>
          <ng-template ngbNavContent>
            If a part of any reading lists and any web links
          </ng-template>
        </li>

        <li [ngbNavItem]="TabID.Cast">
          <a ngbNavLink>{{t('cast-tab')}}</a>
          <ng-template ngbNavContent>
            <app-cast-tab [metadata]="chapter"></app-cast-tab>
          </ng-template>
        </li>
      </ul>

      <div [ngbNavOutlet]="nav"></div>

    }



    <app-loading [loading]="isLoading"></app-loading>
  </div>

</ng-container>
