<div class="container-flex {{darkMode ? 'dark-mode' : ''}} reader-container" tabindex="0" #reader>
    <div class="fixed-top" #stickyTop>
        <a class="visually-hidden-focusable focus-visible" href="javascript:void(0);" (click)="moveFocus()">Skip to main content</a>
        <ng-container [ngTemplateOutlet]="actionBar"></ng-container>
        <app-drawer #commentDrawer="drawer" [(isOpen)]="drawerOpen" [options]="{topOffset: topOffset}">
            <h5 header>
                Book Settings
            </h5>
            <div subheader>
                <div class="row g-0">
                    <button class="btn btn-small btn-icon col-1" style="padding-left: 0px" [disabled]="prevChapterDisabled" (click)="loadPrevChapter()" title="Prev Chapter/Volume"><i class="fa fa-fast-backward" aria-hidden="true"></i></button>
                    <div class="col-1 page-stub ps-1">{{pageNum}}</div>
                    <div class="col-8 pe-1" style="margin-top: 15px">
                        <ngb-progressbar style="cursor: pointer" title="Go to page" (click)="goToPage()" type="primary" height="5px" [value]="pageNum" [max]="maxPages - 1"></ngb-progressbar>
                    </div>
                    <div class="col-1 btn-icon page-stub pe-1" (click)="goToPage(maxPages - 1)" title="Go to last page">{{maxPages - 1}}</div>
                    <button class="btn btn-small btn-icon col-1" style="padding-right: 0px; padding-left: 0px" [disabled]="nextChapterDisabled" (click)="loadNextChapter()" title="Next Chapter/Volume"><i class="fa fa-fast-forward" aria-hidden="true"></i></button>
                </div>
            </div>
            <div body class="drawer-body">
                <!-- TODO: Center align the tab pills -->
                <nav role="navigation">
                    <ul ngbNav #nav="ngbNav" [(activeId)]="activeTabId" class="nav nav-pills mb-2" [destroyOnHide]="false">
                        <li [ngbNavItem]="TabID.Settings">
                            <a ngbNavLink>Settings</a>
                            <ng-template ngbNavContent>
                                <app-reader-settings
                                    (colorThemeUpdate)="setOverrideStyles($event)"
                                    (styleUpdate)="updateReaderStyles($event)"
                                    (clickToPaginateChanged)="showPaginationOverlay($event)"
                                    (fullscreen)="toggleFullscreen()"
                                    (layoutModeUpdate)="updateLayoutMode($event)"
                                    (readingDirection)="readingDirection = $event"
                                ></app-reader-settings>
                            </ng-template>
                          </li>

                          <li [ngbNavItem]="TabID.TableOfContents">
                            <a ngbNavLink>Table of Contents</a>
                            <ng-template ngbNavContent>
                                <app-table-of-contents [chapters]="chapters" [chapterId]="chapterId" [pageNum]="pageNum" [currentPageAnchor]="currentPageAnchor" (loadChapter)="loadChapterPage($event)"></app-table-of-contents>
                            </ng-template>
                          </li>
                    </ul>
                </nav>
                <div [ngbNavOutlet]="nav" class="mt-3"></div>
            </div>
        </app-drawer>
    </div>

    <div #readingSection class="reading-section {{ColumnLayout}}" [ngStyle]="{'padding-top': topOffset + 20 + 'px'}"
        [@isLoading]="isLoading ? true : false">

        <div #readingHtml class="book-content" [ngStyle]="{'padding-bottom': topOffset + 20 + 'px', 'margin': '0px 0px', 'height': 'auto', 'max-height': ColumnHeight, 'column-width': ColumnWidth}"
            [innerHtml]="page" *ngIf="page !== undefined"></div>

        <ng-container  *ngIf="clickToPaginate">
            <div class="left {{clickOverlayClass('left')}} no-observe" [ngStyle]="{'padding-top': topOffset + 'px'}" (click)="prevPage()" tabindex="-1"></div>
            <div class="{{scrollbarNeeded ? 'right-with-scrollbar' : 'right'}} {{clickOverlayClass('right')}} no-observe" [ngStyle]="{'padding-top': topOffset + 'px'}" (click)="nextPage()" tabindex="-1"></div>
        </ng-container>

        <div *ngIf="page !== undefined && (scrollbarNeeded || layoutMode !== BookPageLayoutMode.Default)" (click)="$event.stopPropagation();">
            <ng-container [ngTemplateOutlet]="actionBar"></ng-container>
        </div>
    </div>

    <ng-template #actionBar>
        <div class="reading-bar row g-0 justify-content-between">
            <button class="btn btn-outline-secondary btn-icon col-2  col-xs-1" (click)="prevPage()"
                [disabled]="IsPrevDisabled"
                title="{{readingDirection === ReadingDirection.LeftToRight ? 'Previous' : 'Next'}} Page">
                <i class="fa {{(readingDirection === ReadingDirection.LeftToRight ? IsPrevChapter : IsNextChapter) ? 'fa-angle-double-left' : 'fa-angle-left'}}" aria-hidden="true"></i>
                <span class="d-none d-sm-block">&nbsp;{{readingDirection === ReadingDirection.LeftToRight ? 'Previous' : 'Next'}}</span>
            </button>
            <button *ngIf="!this.adhocPageHistory.isEmpty()" class="btn btn-outline-secondary btn-icon col-2 col-xs-1" (click)="goBack()" title="Go Back"><i class="fa fa-reply" aria-hidden="true"></i><span class="d-none d-sm-block">&nbsp;Go Back</span></button>
            <button class="btn btn-secondary col-2 col-xs-1" (click)="toggleDrawer()"><i class="fa fa-bars" aria-hidden="true"></i><span class="d-none d-sm-block">Settings</span></button>
            <div class="book-title col-2 d-none d-sm-block">
                <ng-container *ngIf="isLoading; else showTitle">
                    <div class="spinner-border spinner-border-sm text-primary" style="border-radius: 50%;" role="status">
                        <span class="visually-hidden">Loading book...</span>
                    </div>
                </ng-container>
                <ng-template #showTitle>
                    <span class="book-title-text">{{bookTitle}}</span>
                    <span *ngIf="incognitoMode" (click)="turnOffIncognito()" role="button" aria-label="Incognito mode is on. Toggle to turn off.">(<i class="fa fa-glasses"  aria-hidden="true"></i><span class="visually-hidden">Incognito Mode</span>)</span>
                </ng-template>
            </div>
            <button class="btn btn-secondary col-2 col-xs-1" (click)="closeReader()"><i class="fa fa-times-circle" aria-hidden="true"></i><span class="d-none d-sm-block">&nbsp;Close</span></button>
            <button class="btn btn-outline-secondary btn-icon col-2  col-xs-1"
                [disabled]="IsNextDisabled"
                (click)="nextPage()" title="{{readingDirection === ReadingDirection.LeftToRight ? 'Next' : 'Previous'}} Page">
                <i class="fa {{(readingDirection === ReadingDirection.LeftToRight ? IsNextChapter : IsPrevChapter) ? 'fa-angle-double-right' : 'fa-angle-right'}}" aria-hidden="true"></i>
                <span class="d-none d-sm-block">{{readingDirection === ReadingDirection.LeftToRight ? 'Next' : 'Previous'}}&nbsp;</span>
            </button>
        </div>
    </ng-template>

</div>
