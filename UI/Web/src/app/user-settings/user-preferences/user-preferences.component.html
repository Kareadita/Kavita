<ng-container *transloco="let t; read:'user-preferences'">
  <app-side-nav-companion-bar>
    <h2 title>
      {{t('title')}}
    </h2>
  </app-side-nav-companion-bar>
  <div class="container-fluid">
    <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav nav-tabs">
      @for(tab of tabs; track tab.fragment) {
        <li [ngbNavItem]="tab">
          <a ngbNavLink routerLink="." [fragment]="tab.fragment">{{ t(tab.title) }}</a>
          <ng-template ngbNavContent>
            @defer (when tab.fragment === FragmentID.Account; prefetch on idle) {
              <app-change-email></app-change-email>
              <app-change-password></app-change-password>
              <app-change-age-restriction></app-change-age-restriction>
              <app-manage-scrobbling-providers></app-manage-scrobbling-providers>
            }

            @defer (when tab.fragment === FragmentID.Preferences; prefetch on idle) {
              <app-manga-user-preferences></app-manga-user-preferences>
            }

            @defer (when tab.fragment === FragmentID.Clients; prefetch on idle) {
              <app-manage-opds></app-manage-opds>
            }

            @defer (when tab.fragment === FragmentID.Theme; prefetch on idle) {
              <app-theme-manager></app-theme-manager>
            }

            @defer (when tab.fragment === FragmentID.Devices; prefetch on idle) {
              <app-manage-devices></app-manage-devices>
            }

            @defer (when tab.fragment === FragmentID.Stats; prefetch on idle) {
              <app-user-stats></app-user-stats>
            }

            @defer (when tab.fragment === FragmentID.Scrobbling; prefetch on idle) {
              @if(hasActiveLicense) {
                <app-user-scrobble-history></app-user-scrobble-history>
                <app-user-holds></app-user-holds>
              }
            }
          </ng-template>
        </li>
      }
    </ul>
    <div [ngbNavOutlet]="nav" class="mt-3"></div>
  </div>
</ng-container>
