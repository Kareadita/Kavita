<ng-container *transloco="let t; read:'theme-manager'">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-8"><h3>{{t('title')}}</h3></div>
      <div class="col-4">
        <div class="float-end">
<!--          <button class="btn btn-primary" (click)="browse()">-->
<!--            <i class="fa fa-refresh" aria-hidden="true"></i>&nbsp;{{t('browse')}}-->
<!--          </button>-->

<!--          @if (isAdmin) {-->
<!--            <button class="btn btn-primary" (click)="scan()">-->
<!--              <i class="fa fa-refresh" aria-hidden="true"></i>&nbsp;{{t('scan')}}-->
<!--            </button>-->
<!--          }-->
        </div>
      </div>
    </div>

    <p>{{t('description')}}</p>


    <div class="row g-0 theme-container">
      <div class="col-md-3">
        <div class="pe-2">
          <ul style="height: 100%" class="list-group list-group-flush">
            @for (theme of themeService.themes$ | async; track theme.name) {
              <ng-container [ngTemplateOutlet]="themeOption" [ngTemplateOutletContext]="{ $implicit: theme}"></ng-container>
            }

            @for (theme of downloadableThemes; track theme.name) {
              <ng-container [ngTemplateOutlet]="themeOption" [ngTemplateOutletContext]="{ $implicit: theme}"></ng-container>
            }
          </ul>
        </div>
      </div>

      <div class="col-md-9">
        @if (selectedTheme === undefined) {
          <p>Select a theme first</p>
        }
        @else {
          <h4>
            {{selectedTheme.name | sentenceCase}}
            <div class="float-end">
              @if (selectedTheme.isSiteTheme) {
                @if (selectedTheme.name !== 'Dark') {
                  <button class="btn btn-danger me-1" (click)="deleteTheme(selectedTheme.site!)">{{t('delete')}}</button>
                }
                @if (hasAdmin$ | async) {
                  <button class="btn btn-secondary me-1" [disabled]="selectedTheme.site?.isDefault" (click)="updateDefault(selectedTheme.site!)">{{t('set-default')}}</button>
                }
                <button class="btn btn-primary me-1" [disabled]="currentTheme && selectedTheme.name === currentTheme.name" (click)="applyTheme(selectedTheme.site!)">{{t('apply')}}</button>
              } @else {
                <button class="btn btn-primary" [disabled]="selectedTheme.downloadable?.alreadyDownloaded" (click)="downloadTheme(selectedTheme.downloadable!)">{{t('download')}}</button>
              }
            </div>
          </h4>
          @if(!selectedTheme.isSiteTheme) {
            <p>{{selectedTheme.downloadable!.description | defaultValue}}</p>

            <app-carousel-reel [items]="selectedTheme.downloadable!.previewUrls" title="Preview">
              <ng-template #carouselItem let-item>
                <a [href]="item | safeUrl" target="_blank" rel="noopener noreferrer">
                  <app-image [imageUrl]="item" height="100px" width="160px"></app-image>
                </a>
              </ng-template>
            </app-carousel-reel>
          } @else {
            <p>{{selectedTheme.site!.description | defaultValue}}</p>

            <app-carousel-reel [items]="selectedTheme.site!.previewUrls" title="Preview">
              <ng-template #carouselItem let-item>
                <a [href]="item | safeUrl" target="_blank" rel="noopener noreferrer">
                  <app-image [imageUrl]="item" height="100px" width="160px"></app-image>
                </a>
              </ng-template>
            </app-carousel-reel>
          }
        }
      </div>
    </div>
  </div>

  <ng-template #themeOption let-item>
    @if (item !== undefined) {

      <li class="list-group-item d-flex justify-content-between align-items-start {{selectedTheme && selectedTheme.name === item.name ? 'active' : ''}}" (click)="selectTheme(item)">
        <div class="ms-2 me-auto">
          <div class="fw-bold">{{item.name | sentenceCase}}</div>

          @if (item.hasOwnProperty('provider')) {
            {{item.provider | siteThemeProvider}}
          } @else if (item.hasOwnProperty('lastCompatibleVersion')) {
            {{ThemeProvider.Provided | siteThemeProvider}} • v{{item.lastCompatibleVersion}}
          }
          @if (currentTheme && item.name === currentTheme.name) {
            • Active
          }
        </div>
        @if (item.hasOwnProperty('isDefault') && item.isDefault) {
          <i class="fa-solid fa-star" aria-label="Default theme"></i>
        }
      </li>
    }
  </ng-template>


</ng-container>
